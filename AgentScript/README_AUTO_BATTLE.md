# 现代战舰代肝脚本

## 功能特性

- **自动识别游戏状态**：检测主界面、战斗界面（进攻/防守）
- **智能回放控制**：检测到进攻模式时自动执行回放，防守模式时退出战斗
- **奖励识别统计**：战斗结束后自动识别获得的美元和黄金奖励
- **实时收益统计**：显示总战斗场次、总奖励、每小时收益
- **VIP状态检测**：自动检测VIP状态，准确计算奖励（含额外奖励）
- **图形化界面**：PyQt5界面，操作简单直观
- **配置保存**：自动保存设备、回放文件、参数等配置

## 依赖要求

```bash
pip install PyQt5 opencv-python numpy cnocr
```

**注意**：
- `cnocr`库用于OCR识别战斗奖励，如果未安装将无法识别奖励数据
- 需要安装Android SDK并配置ADB环境

## 目录结构

```
AgentScript/
├── warship_auto_battle.py     # 主程序
├── start_auto_battle.py       # 启动器
├── battle_config.json         # 配置文件
├── battle_stats.json          # 统计数据文件
├── 启动代肝脚本.bat           # Windows启动脚本
├── templates/                 # 模板文件目录
│   ├── main_page.png         # 主界面识别模板
│   ├── fighting.png          # 进攻模式识别模板
│   ├── fangshou.png          # 防守模式识别模板
│   └── no_vip.png            # 非VIP状态识别模板
├── recording/                 # 回放文件目录
└── cache/                     # 缓存目录
```

## 模板文件说明

需要准备以下模板图片文件，放在`templates/`目录下：

1. **main_page.png** - 主界面特征图片
   - 用于识别游戏主界面状态
   - 检测区域：(2109, 40, 2254, 92)

2. **fighting.png** - 进攻模式特征图片
   - 用于识别战斗中的进攻状态
   - 检测区域：(2109, 40, 2254, 92)

3. **fangshou.png** - 防守模式特征图片
   - 用于识别战斗中的防守状态
   - 检测区域：(2109, 40, 2254, 92)

4. **no_vip.png** - 非VIP状态特征图片
   - 用于检测结算界面是否为非VIP状态
   - 检测区域：(1482, 425, 1519, 465)
   - 如果匹配到此模板，则不计算额外VIP奖励

## 奖励识别区域

程序会自动识别以下区域的奖励数据：

- **美元基础奖励**：(1060, 383, 1187, 412)
- **美元额外奖励**：(1477, 382, 1592, 412) - 仅VIP用户
- **黄金基础奖励**：(1335, 382, 1375, 410)
- **黄金额外奖励**：(1749, 382, 1777, 410) - 仅VIP用户

## 使用方法

1. **准备工作**
   - 确保安卓设备已连接并开启USB调试
   - 准备好模板图片文件
   - 录制战斗回放文件(JSON格式)

2. **启动脚本**
   - 双击`启动代肝脚本.bat`
   - 或运行`python start_auto_battle.py`

3. **配置设置**
   - 选择连接的设备
   - 选择回放文件
   - 调整长按补偿和检查间隔

4. **开始运行**
   - 点击"开始运行"按钮
   - 脚本将自动检测游戏状态并执行相应操作

## 工作流程

1. **主界面** → 点击匹配按钮，等待13秒
2. **防守模式** → 发送返回键退出战斗
3. **进攻模式** → 执行回放，完成后识别奖励，更新统计数据
4. **其他界面** → 发送返回键返回主界面

## 统计功能

- **实时显示**：战斗场次、总美元、总黄金、每小时收益
- **数据持久化**：统计数据自动保存到`battle_stats.json`
- **VIP识别**：准确区分VIP和非VIP用户的奖励
- **收益计算**：从脚本启动开始计时，实时计算收益效率

## 注意事项

- 模板图片需要根据实际游戏界面截取
- 奖励识别区域坐标可能需要根据不同分辨率调整
- 确保OCR库正常安装，否则无法识别奖励数据
- 建议在稳定的网络环境下使用

## 故障排除

1. **识别失败** - 检查模板图片是否正确截取
2. **OCR错误** - 确认cnocr库已正确安装
3. **设备连接** - 检查ADB连接和USB调试设置
4. **回放失败** - 确认回放文件格式正确且路径无误

## 安全说明

- 本脚本仅用于学习和研究目的
- 使用前请确认符合游戏的使用条款
- 建议在测试环境中先验证脚本功能

## 技术支持

如有问题，请检查：
1. 依赖是否正确安装
2. ADB是否正常工作
3. 设备是否正确连接
4. 模板文件是否存在

---

**注意**：使用自动化脚本可能违反游戏条款，请谨慎使用并承担相应风险。 